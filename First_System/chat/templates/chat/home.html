<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 font-sans antialiased">
    <div class="container mx-auto p-6">
      <!-- Header -->
      <div class="text-center mb-8">
        <h2 class="text-4xl font-semibold text-gray-800">
          Welcome to the Home Page
        </h2>
        <p class="mt-2 text-lg text-gray-600">
          You are logged in as {{ user.username }}
        </p>
        <a
          href="{% url 'logout' %}"
          class="text-blue-500 hover:text-blue-700 mt-4 inline-block"
          >Logout</a
        >
      </div>

      <!-- Room Name Input Section -->
      <div class="mb-4">
        <label
          for="room-name-input"
          class="block text-lg font-semibold text-gray-800 mb-2"
        >
          Enter Room Name
        </label>
        <input
          type="text"
          id="room-name-input"
          placeholder="Enter a room name"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <!-- Submit Button -->
      <div class="text-center">
        <button
          id="room-name-submit"
          class="bg-blue-500 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600"
          onclick="joinRoom()"
        >
          Join Room
        </button>
      </div>

      <!-- User Table -->
      <div class="overflow-x-auto bg-white shadow-md rounded-lg mt-5">
        <table class="min-w-full table-auto">
          <thead class="bg-gray-200">
            <tr>
              <th class="px-6 py-3 text-left text-gray-600">Username</th>
              <th class="px-6 py-3 text-left text-gray-600">Actions</th>
            </tr>
          </thead>

          <tbody>
            {% for username in usernames %}
            <tr class="border-b hover:bg-gray-50">
              <td class="px-6 py-4 text-gray-800">{{ username }}</td>
              <td class="px-6 py-4 text-center">
                <div class="flex justify-center space-x-4">
                  <!-- View Messages Button -->
                  <button
                    class="bg-blue-500 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
                    onclick="alert('View messages for {{ username }}')"
                  >
                    View Messages
                  </button>
                  <!-- Delete User Button -->
                  <button
                    class="bg-red-500 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-red-600"
                    onclick="confirmDelete('{{ username }}')"
                  >
                    Delete User
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <script>
      // Pass the current username dynamically from Django into JavaScript
      const userName = "{{ user.username }}";

      // Focus on the room name input field when the page loads
      document.querySelector("#room-name-input").focus();

      // Function to handle room joining
      function joinRoom() {
        const roomName = document
          .querySelector("#room-name-input")
          .value.trim();
        if (roomName) {
          // Construct the URL with the room name and username as query parameters
          window.location.replace(`../${roomName}/?username=${userName}`);
        } else {
          alert("Please enter a room name.");
        }
      }

      // Function to handle user deletion
      function confirmDelete(username) {
        if (confirm(`Are you sure you want to delete user ${username}?`)) {
          window.location.href = `/delete_user/${username}/`; // Redirect to user deletion URL
        }
      }
    </script>
  </body>
</html>
